<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Facial Anonymiser using AWS Rekognition</title>
    <link rel="stylesheet" type="text/css" media="all" href="styles/global.css"/>
    <link rel="stylesheet" type="text/css" href="styles/flexboxgrid.min.css" />
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.259.1.min.js"></script>
    <script>

        var myRegion = 'eu-west-2';
        var IdentityPoolId = 'eu-west-2:5f4fed45-de99-4442-9ee3-948b430bcc45';

        AWS.config.update({
            region: myRegion,
            credentials: new AWS.CognitoIdentityCredentials({
                IdentityPoolId: IdentityPoolId
            })
        });


        function displayOutput() {

            var d = new Date();

            document.getElementById('outfile').innerHTML = '<img id="outputMain" src="https://pez-rekog-image1.s3.eu-west-2.amazonaws.com/output.jpg?' + d.getSeconds() + '">';
        }

        function invokeLambda(photoName) {

            document.getElementById('outfile').innerHTML = '';
             document.getElementById('loader').style.display = 'block';

            var lambda = new AWS.Lambda();

            var params = {
                FunctionName: "rekogFaceAnon",
                Payload: '{"photo_name": "' + photoName + '" }'
            };


            lambda.invoke(params, function (err, data) {
                if (err) console.log(err, err.stack); // an error occurred
                else {
                    // successful response
                    console.log(data);
                    document.getElementById('loader').style.display = 'none';
                    displayOutput();
                }
            });

        }

      </script>
</head>
<body>
<header>
    <h1>AWS Rekognition face Anonymiser</h1>
</header>
<section>
    <div class="row center-xs">
        <div class="col-xs-6">

            <div class="selector">

                <a href="#" class="img-hover-zoom" onclick="invokeLambda('wikipeople1.jpg')">
                    <img src="images/thumbs/wikipeople1.jpg" alt="Example image">
                </a>

                <a href="#" class="img-hover-zoom" onclick="invokeLambda('wikipeople2.jpg')">
                    <img src="images/thumbs/wikipeople2.jpg" alt="Example image">
                </a>

                <a href="#" class="img-hover-zoom" onclick="invokeLambda('wikipeople3.jpg')">
                    <img src="images/thumbs/wikipeople3.jpg" alt="Example image">
                </a>

                <a href="#" class="img-hover-zoom" onclick="invokeLambda('wikipeople4.jpg')">
                    <img src="images/thumbs/wikipeople4.jpg" alt="Example image">
                </a>

                <a href="#" class="img-hover-zoom" onclick="invokeLambda('wikipeople5.jpg')">
                    <img src="images/thumbs/wikipeople5.jpg" alt="Example image">
                </a>

            </div>

        </div>
    </div>
    <div class="row center-xs">
        <div class="col-xs-6">
                <div id="outputPlaceholder">
                    <span id="outfile"></span>
                    <div id="loader" style="display: none;"></div>
                </div>
        </div>
    </div>
</section>
</div>
</section>
</body>
</html>