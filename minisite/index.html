<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Facial Anonymiser using AWS Rekognition</title>
    <link rel="stylesheet" type="text/css" media="all" href="styles/global.css"/>
    <link rel="stylesheet" type="text/css" href="styles/flexboxgrid.min.css" />
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.259.1.min.js"></script>
    <script>

        var myRegion = 'eu-west-2';
        var IdentityPoolId = 'eu-west-2:5f4fed45-de99-4442-9ee3-948b430bcc45';
        var slideIndex = 0;
        var slideInt = 0;
        var slides = document.getElementsByClassName("slide");


        AWS.config.update({
            region: myRegion,
            credentials: new AWS.CognitoIdentityCredentials({
                IdentityPoolId: IdentityPoolId
            }),
            convertResponseTypes: !1,
        });

        function displayOutput(info) {

            var d = new Date();

            document.getElementById('jobtime').innerHTML = info.jobtime + "ms";
            document.getElementById('facecount').innerHTML = info.facecount;
            document.getElementById('outputMain').src = 'http://' + info.result_uri + '?' + d.getSeconds();

            nextSlide();
            slideInt = setInterval(nextSlide, 3000);
        }

        function invokeLambda(photoName) {

            hideSlides();
            //knock the prompt slide out of play, we won't need it again.
            slideIndex=1;
            document.getElementById('loader').style.display = 'block';

            var lambda = new AWS.Lambda();

            var params = {
                FunctionName: "rekogFaceAnon",
                Payload: '{"photo_name": "' + photoName + '" }'
            };


            lambda.invoke(params, function (err, data) {
                if (err) console.log(err, err.stack); // an error occurred
                else {
                    // successful response
                    response = JSON.parse(data.Payload)
                    console.log(response);
                    document.getElementById('loader').style.display = 'none';
                    displayOutput(response);
                }
            });
            //preventDefault
            return false;

        }
        function hideSlides() {
            var end = slides.length;
            for (i = 0; i < end; i++) {
                slides[i].style.display = "none";
            }
        }

        function nextSlide() {
            hideSlides()
            slides[slideIndex].style.display = "block";
            if (slideIndex +1 >= slides.length) {
                clearInterval(slideInt);
                slideIndex=0;
            } else {
                slideIndex++;
            }
        }

    </script>
</head>
<body>
<header>
    <h1>AWS Rekognition face Anonymiser</h1>
</header>

<div class="row">
    <div class="col section-container">
        <div class="row section-header between-xs">
            <div class="col"><span>AWS / Python Project</span></div>
            <div class="col"></div>
            <div class="col">Jun-July 2020</div>
        </div>
        <div class ="bodytext">
            <p>Facial recognition is often discussed in reference to its use for identification, however facial recognition is just as important for *Anonymisation*<p>
            <p>With more and more jurisdictions recognising an individual's right to control the use of their digital image, its pretty handy for content creators to have the tools to locate and obscure identifiable faces in an image.</p>
            <p>I'd been considering how I could craft such an app using Keras/tensorflow and publicly-available facial recognition libraries when I discovered that AWS provides facial location as a service in Amazon Rekognition.</p>
            <p>It occurred to me that this would be a great demonstration of the possibilities of AWS lambda Applications!</p>
            <p>This project provides a Lambda function to query Rekognition and use the results to obscure the photo data in the identified regions of various public domain photgraphs.</p>

        </div>
    </div>
</div>
<section>
    <div class="row center-xs picker">
        <div class="col">

            <div>

                <a href="#" class="img-hover-zoom" onclick="invokeLambda('wikipeople1.jpg');return false;">
                    <img src="images/thumbs/wikipeople1.jpg" alt="celebrity thumbnail photo">
                </a>

                <a href="#" class="img-hover-zoom" onclick="invokeLambda('wikipeople2.jpg');return false;">
                    <img src="images/thumbs/wikipeople2.jpg" alt="celebrity thumbnail photo">
                </a>

                <a href="#" class="img-hover-zoom" onclick="invokeLambda('wikipeople3.jpg');return false;">
                    <img src="images/thumbs/wikipeople3.jpg" alt="celebrity thumbnail photo">
                </a>

                <a href="#" class="img-hover-zoom" onclick="invokeLambda('wikipeople4.jpg');return false;">
                    <img src="images/thumbs/wikipeople4.jpg" alt="celebrity thumbnail photoe">
                </a>

                <a href="#" class="img-hover-zoom" onclick="invokeLambda('wikipeople5.jpg');return false;">
                    <img src="images/thumbs/wikipeople5.jpg" alt="celebrity thumbnail photo">
                </a>

            </div>

        </div>
    </div>
    <div class="row center-xs center-sm center-md center-lg ">
        <div class="col-xs-12 col-sm-10 col-md-12 col-lg-10">
            <div id="outputPlaceholder">
                <div id="loader" style="display: none;"></div>
                <div class="slideshow">
                    <div class="slide">
                        <div class="slide-text">
                            <p>Click an image above to anonymise.</p>
                        </div>
                    </div>
                    <div class="fade slide" style="display: none;">
                        <div class="slide-text">
                            <p>Processed in</p>
                            <h2 id="jobtime">0ms</h2>
                        </div>
                    </div>
                    <div class="fade slide" style="display: none;">
                        <div class="slide-text">
                            <h2 id ="facecount">0</h2>
                            <p>Faces Detected</p>
                        </div>
                    </div>
                    <div class="fade slide" style="display: none;">
                        <img id="outputMain" src="#">
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<div class="row center-xs footer">
    <div class="col">
        <p>Laid down with <a href="http://flexboxgrid.com">flexboxgrid</a><br />
        All images licensed under <a href="https://creativecommons.org">Creative Commons</a></p>
    </div>
</div>
</body>
</html>